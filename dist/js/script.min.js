"use strict";!function(){function i(){return Math.floor(9*Math.random()+1)}function p(t,e){return $('div[data-col="'.concat(t,'"][data-row="').concat(e,'"]'))[0]}function o(){this.gridContainer=document.getElementById("grid-container"),this.player1=null,this.player2=null,this.barriers=[],this.weapons=o.WEAPONS,this.activePlayer="player1",this.defending=!1;var i=this;$(this.gridContainer).click(function(t){var e=t.target,o={col:Number(e.dataset.col),row:Number(e.dataset.row)};i.tryMoveActivePlayer(o),i.tryFight()})}var t="sword";function e(t,e){this.name=t,this.weapon=o.WEAPONS[e],this.position={col:1,row:1},this.lastPosition={col:1,row:1},this.health=100,this.inTurn=!1,this.fighting=!1,this.defending=!1}o.WEAPONS={sword:{key:"sword",position:null,damage:10,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586770/BlackKnight/sword_qz2ido.gif>"},fire:{key:"fire",position:null,damage:15,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586765/BlackKnight/fire_hheehz.gif>"},magic:{key:"magic",position:null,damage:20,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586778/BlackKnight/magic_y0biuz.gif>"},staff:{key:"staff",position:null,damage:25,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586769/BlackKnight/staff_ushxa4.png>"}},o.prototype.gameSetup=function(){this.barriers=[],this.weapons=o.WEAPONS,this.activePlayer="player1",this.createGrid();for(var t=0;t<13;t++)this.placeBarrier([t]);this.player1=this.createPlayer1(),this.player1.activePlayer=!0,this.placePlayer(this.player1),this.showAllMoves(this.player1.position),this.player2=this.createPlayer2(),this.placePlayer(this.player2),this.isReadyToFight()?this.gameSetup():(this.placeWeapon("sword"),this.placeWeapon("fire"),this.placeWeapon("magic"),this.placeWeapon("staff"),this.getPlayerStats())},o.prototype.createPlayer1=function(){return new e("player1",t)},o.prototype.createPlayer2=function(){return new e("player2",t)},o.prototype.createGrid=function(){for(var t="",e=1;e<11;e++)for(var o=1;o<11;o++)t+="<div class='grid-item' data-col=".concat(o," data-row=").concat(e," ></div>");this.gridContainer.innerHTML=t},e.prototype.getPosition=function(){return p(this.position.col,this.position.row)},o.prototype.isPositionAvailable=function(t,e){return!p(t.col,t.row).classList.contains("taken")||(e&&e(),!1)},o.prototype.putClass=function(t,e,o){var i=p(t.col,t.row);i.classList.add(e),o||i.classList.add("taken")},o.prototype.putWeaponInfo=function(t){p(t.col,t.row).classList.add("sword")},o.prototype.removeClass=function(t,e){var o=p(t.col,t.row);o.classList.remove(e),o.classList.remove("taken")},o.prototype.placeBarrier=function(){var t={col:i(),row:i()},e=this;this.isPositionAvailable(t,function(){e.placeBarrier()})&&(this.barriers.push(t),this.putClass(t,"barrier"))},o.prototype.placeWeapon=function(t){var e={col:i(),row:i()},o=this;this.isPositionAvailable(e,function(){o.placeWeapon(t)})&&(this.weapons[t].position=e,this.putClass(e,t,!0))},o.prototype.placePlayer=function(t){var e={col:i(),row:i()},o=this;this.isPositionAvailable(e,function(){o.placePlayer(t)})&&(t.moveTo(e,!0),this.putClass(e,t.name))},o.prototype.hasBarriers=function(t,e){var o=e.col==t.col?"row":"col",i="col"==o?t.col-e.col:t.row-e.row,a="col"==o?t.col-1:t.col,r="row"==o?t.row-1:t.row;i<0&&(a="col"==o?t.col+1:t.col,r="row"==o?t.row+1:t.row);var s={col:a,row:r},n=p(s.col,s.row);return!!n&&(!!n.classList.contains("barrier")||Math.abs(i)!==Math.abs(t[o]-s[o])&&this.hasBarriers(s,e))},e.prototype.moveTo=function(t){this.lastPosition=Object.assign({},this.position),this.position=t},o.prototype.movePlayer=function(t,e){this.removeClass(t.position,t.name),this.putClass(e,t.name),t.moveTo(e),this.switchWeapon(t)},e.prototype.canMoveTo=function(t,e){var o=t.col===this.position.col?"row":"col",i=Math.abs(this.position.col-t.col),a=Math.abs(this.position.row-t.row),r="col"==o&&i<=3&&0===a||"row"==o&&a<=3&&0===i;return r&&e&&e(),r},o.prototype.tryMovePlayer=function(t,e){var o=this,i=p(e.col,e.row);t.canMoveTo(e,function(){o.isPositionAvailable(e)&&!o.hasBarriers(t.position,e)&&i.classList.contains("highlight")&&(o.movePlayer(t,e),o.removeShowMove(),o.switchActivePlayer(),o.showAllMoves(o[o.activePlayer].position))})},o.prototype.tryMoveActivePlayer=function(t){this.tryMovePlayer(this[this.activePlayer],t)},o.prototype.showMove=function(t){p(t.col,t.row).classList.add("highlight")},o.prototype.removeShowMove=function(){for(var t=document.getElementsByClassName("highlight");t[0];)t[0].classList.remove("highlight")},o.prototype.showAllMoves=function(t){for(var e={col:t.col,row:t.row},o=0;o<3;o++){e.row+=1;var i=p(e.col,e.row);if(!(0<e.row&&e.row<11&&!1===i.classList.contains("barrier")))break;this.showMove(e)}e.row=t.row;for(var a=0;a<3;a++){e.col+=1;var r=p(e.col,e.row);if(!(0<e.col&&e.col<11&&!1===r.classList.contains("barrier")))break;this.showMove(e)}e.col=t.col;for(var s=0;s<3;s++){--e.row;var n=p(e.col,e.row);if(!(0<e.row&&e.row<11&&!1===n.classList.contains("barrier")))break;this.showMove(e)}e.row=t.row;for(var l=0;l<3;l++){--e.col;var c=p(e.col,e.row);if(!(0<e.col&&e.col<11&&!1===c.classList.contains("barrier")))break;this.showMove(e)}e.col=t.col},o.prototype.findWeaponByPosition=function(e){return Object.values(this.weapons).find(function(t){return t.position&&t.position.col===e.col&&t.position.row===e.row})},o.prototype.switchWeapon=function(t){var e=t.position,o=this.findWeaponByPosition(e);o&&(this.weapons[t.weapon.key].position=e,this.removeClass(e,o.key),this.putClass(e,t.weapon.key,!0),this.getPlayerStats(),this.weapons[o.key].position=null,t.weapon=this.weapons[o.key],this.getPlayerStats())},o.prototype.switchActivePlayer=function(){this.activePlayer="player1"===this.activePlayer?"player2":"player1";var t="player1"===this.activePlayer?"player2":"player1";this[this.activePlayer].activePlayer=!0,this[t].activePlayer=!1},o.prototype.isReadyToFight=function(){var t=this.player1.position.col,e=this.player1.position.row,o=this.player2.position.col,i=this.player2.position.row,a=Math.abs(t-o),r=Math.abs(e-i);return(1===a&&0===r||1===r&&0===a)&&(document.querySelector("#fight").innerHTML="FIGHT!",!0)},o.prototype.getPlayerStats=function(){var t=document.querySelector("#knightHealthInput"),e=document.querySelector("#knightAttackInput"),o=document.querySelector("#knightWeaponPanel");t.innerHTML=this.player1.health,e.innerHTML=this.player1.weapon.damage,o.innerHTML=this.player1.weapon.img;var i=document.querySelector("#dragonHealthInput"),a=document.querySelector("#dragonAttackInput"),r=document.querySelector("#dragonWeaponPanel");i.innerHTML=this.player2.health,a.innerHTML=this.player2.weapon.damage,r.innerHTML=this.player2.weapon.img},o.prototype.enableFightButton=function(){var t=document.getElementById("P1Attack"),e=document.getElementById("P2Attack"),o=document.getElementById("P1Defend"),i=document.getElementById("P2Defend");"player1"==this.activePlayer?(t.classList.remove("disabled"),o.classList.remove("disabled"),e.classList.add("disabled"),i.classList.add("disabled")):(e.classList.remove("disabled"),i.classList.remove("disabled"),t.classList.add("disabled"),o.classList.add("disabled"))},o.prototype.createActionButtonsEvents=function(){var o=this;Array.from(document.querySelectorAll(".action")).forEach(function(t){t.addEventListener("click",function(t){var e=t.target.dataset.actiontype;if(t.target.dataset.playerkey!=o.activePlayer)return window.alert("You can't perform an action because the active player is: ".concat(o.activePlayer));switch(e){case"attack":o.performAction({type:"attack"});break;case"defense":o.performAction({type:"defense"})}0<o.player1.health&&0<o.player2.health||(o.player2.health<=0&&alert("PLAYER 1 WINS !!!"),o.player1.health<=0&&alert("PLAYER 2 WINS !!!"),o.gameSetup())})})},o.prototype.performAction=function(t){switch(t.type){case"attack":var e=this["player1"==this.activePlayer?"player2":"player1"],o=this[this.activePlayer];e.health-=e.defending?o.weapon.damage/2:o.weapon.damage,this.getPlayerStats(),e.defending=!1;break;case"defense":this[this.activePlayer].defending=!0}this.activePlayer="player1"==this.activePlayer?"player2":"player1",this.enableFightButton()},o.prototype.tryFight=function(){this.isReadyToFight()&&this.enableFightButton()},$(window).on("load",function(){document.getElementById("newGameBtn").addEventListener("click",function(){var t=new o;t.gameSetup(),t.createActionButtonsEvents()}),document.getElementById("rulesButton").addEventListener("click",function(){$("#rulesModal").css("display","block")}),document.getElementById("rulesClose").addEventListener("click",function(){$("#rulesModal").css("display","none")})})}();