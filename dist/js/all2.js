"use strict";!function(){function i(){return Math.floor(9*Math.random()+1)}function p(e,t){return $('div[data-col="'.concat(e,'"][data-row="').concat(t,'"]'))[0]}function o(){this.gridContainer=document.getElementById("grid-container"),this.player1=null,this.player2=null,this.barriers=[],this.weapons=o.WEAPONS,this.activePlayer="player1",this.defending=!1;var i=this;$(this.gridContainer).click(function(e){var t=e.target,o={col:Number(t.dataset.col),row:Number(t.dataset.row)};i.tryMoveActivePlayer(o),i.tryFight()})}function e(e,t){this.name=e,this.weapon=o.WEAPONS[t],this.position={col:1,row:1},this.lastPosition={col:1,row:1},this.health=100,this.inTurn=!1,this.fighting=!1,this.defending=!1}o.WEAPONS={player1sword:{key:"player1sword",position:null,damage:10,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586770/BlackKnight/sword_qz2ido.gif>"},player2sword:{key:"player2sword",position:null,damage:10,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586770/BlackKnight/sword_qz2ido.gif>"},sword:{key:"sword",position:null,damage:10,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586770/BlackKnight/sword_qz2ido.gif>"},fire:{key:"fire",position:null,damage:15,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586765/BlackKnight/fire_hheehz.gif>"},magic:{key:"magic",position:null,damage:20,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586778/BlackKnight/magic_y0biuz.gif>"},staff:{key:"staff",position:null,damage:25,img:"<img src= https://res.cloudinary.com/dfqr8gqss/image/upload/v1590586769/BlackKnight/staff_ushxa4.png>"}},o.prototype.gameSetup=function(){this.barriers=[],this.weapons=o.WEAPONS,this.activePlayer="player1",this.createGrid();for(var e=0;e<13;e++)this.placeBarrier([e]);this.player1=this.createPlayer1(),this.player1.activePlayer=!0,this.placePlayer(this.player1),this.showAllMoves(this.player1.position),this.player2=this.createPlayer2(),this.placePlayer(this.player2),this.isReadyToFight()?this.gameSetup():(this.placeWeapon("sword"),this.placeWeapon("fire"),this.placeWeapon("magic"),this.placeWeapon("staff"),this.getPlayerStats(),console.log(this.player1),console.log(this.barriers),console.log(this.weapons))},o.prototype.createPlayer1=function(){return new e("player1","player1sword")},o.prototype.createPlayer2=function(){return new e("player2","player2sword")},o.prototype.createGrid=function(){for(var e="",t=1;t<11;t++)for(var o=1;o<11;o++)e+="<div class='grid-item' data-col=".concat(o," data-row=").concat(t," ></div>");this.gridContainer.innerHTML=e},e.prototype.getPosition=function(){return p(this.position.col,this.position.row)},o.prototype.isPositionAvailable=function(e,t){return!p(e.col,e.row).classList.contains("taken")||(console.log("position taken"),t&&t(),!1)},o.prototype.putClass=function(e,t,o){console.log(t);var i=p(e.col,e.row);i.classList.add(t),o||i.classList.add("taken")},o.prototype.putWeaponInfo=function(e){var t=p(e.col,e.row);console.log(newClass+"is in this position"),t.classList.add("sword")},o.prototype.removeClass=function(e,t){var o=p(e.col,e.row);console.log(o),o.classList.remove(t),o.classList.remove("taken")},o.prototype.placeBarrier=function(){var e={col:i(),row:i()},t=this;this.isPositionAvailable(e,function(){t.placeBarrier()})&&(this.barriers.push(e),this.putClass(e,"barrier"))},o.prototype.placeWeapon=function(e){var t={col:i(),row:i()},o=this;this.isPositionAvailable(t,function(){o.placeWeapon(e)})&&(this.weapons[e].position=t,this.putClass(t,e,!0),console.log(e))},o.prototype.placePlayer=function(e){var t={col:i(),row:i()},o=this;this.isPositionAvailable(t,function(){o.placePlayer(e)})&&(e.moveTo(t,!0),this.putClass(t,e.name))},o.prototype.hasBarriers=function(e,t){var o=t.col==e.col?"row":"col",i="col"==o?e.col-t.col:e.row-t.row,a="col"==o?e.col-1:e.col,s="row"==o?e.row-1:e.row;i<0&&(a="col"==o?e.col+1:e.col,s="row"==o?e.row+1:e.row);var r={col:a,row:s},n=p(r.col,r.row);return!!n&&(n.classList.contains("barrier")?(console.log("barrier exists"),!0):Math.abs(i)!==Math.abs(e[o]-r[o])&&this.hasBarriers(r,t))},e.prototype.moveTo=function(e){console.log(e),this.lastPosition=Object.assign({},this.position),console.log(this.lastPosition),this.position=e},o.prototype.movePlayer=function(e,t){console.log(e),this.removeClass(e.position,e.name),this.putClass(t,e.name),e.moveTo(t),console.log(t),this.switchWeapon(e),console.log(e.weapon)},e.prototype.canMoveTo=function(e,t){var o=e.col===this.position.col?"row":"col",i=Math.abs(this.position.col-e.col),a=Math.abs(this.position.row-e.row),s="col"==o&&i<=3&&0===a||"row"==o&&a<=3&&0===i;return s&&t&&t(),s},o.prototype.tryMovePlayer=function(e,t){var o=this,i=p(t.col,t.row);e.canMoveTo(t,function(){o.isPositionAvailable(t)&&!o.hasBarriers(e.position,t)&&i.classList.contains("highlight")&&(console.log(o.activePlayer),o.movePlayer(e,t),o.removeShowMove(),o.switchActivePlayer(),o.showAllMoves(o[o.activePlayer].position))})},o.prototype.tryMoveActivePlayer=function(e){this.tryMovePlayer(this[this.activePlayer],e),console.log(this.activePlayer)},o.prototype.showMove=function(e){p(e.col,e.row).classList.add("highlight")},o.prototype.removeShowMove=function(){for(var e=document.getElementsByClassName("highlight");e[0];)e[0].classList.remove("highlight")},o.prototype.showAllMoves=function(e){for(var t={col:e.col,row:e.row},o=0;o<3;o++){t.row+=1;var i=p(t.col,t.row);if(!(0<t.row&&t.row<11&&!1===i.classList.contains("barrier")))break;this.showMove(t)}t.row=e.row;for(var a=0;a<3;a++){t.col+=1;var s=p(t.col,t.row);if(!(0<t.col&&t.col<11&&!1===s.classList.contains("barrier")))break;this.showMove(t)}t.col=e.col;for(var r=0;r<3;r++){--t.row;var n=p(t.col,t.row);if(!(0<t.row&&t.row<11&&!1===n.classList.contains("barrier")))break;this.showMove(t)}t.row=e.row;for(var l=0;l<3;l++){--t.col;var c=p(t.col,t.row);if(!(0<t.col&&t.col<11&&!1===c.classList.contains("barrier")))break;this.showMove(t)}t.col=e.col},o.prototype.findWeaponByPosition=function(t){return Object.values(this.weapons).find(function(e){return e.position&&e.position.col===t.col&&e.position.row===t.row})},o.prototype.switchWeapon=function(e){var t=e.position,o=this.findWeaponByPosition(t);o&&(this.weapons[e.weapon.key].position=t,this.putClass(t,e.weapon.key,!0),this.getPlayerStats(),this.weapons[o.key].position=null,this.removeClass(t,o.key),e.weapon=this.weapons[o.key],this.getPlayerStats())},o.prototype.switchActivePlayer=function(){this.activePlayer="player1"===this.activePlayer?"player2":"player1";var e="player1"===this.activePlayer?"player2":"player1";this[this.activePlayer].activePlayer=!0,this[e].activePlayer=!1},o.prototype.isReadyToFight=function(){var e=this.player1.position.col,t=this.player1.position.row,o=this.player2.position.col,i=this.player2.position.row,a=Math.abs(e-o),s=Math.abs(t-i);if(1===a&&0===s||1===s&&0===a){var r=document.querySelector("#fight");return console.log(r),r.innerHTML="FIGHT!",console.log("Player ready to fight"),!0}return!1},o.prototype.getPlayerStats=function(){var e=document.querySelector("#knightHealthInput"),t=document.querySelector("#knightAttackInput"),o=document.querySelector("#knightWeaponPanel");e.innerHTML=this.player1.health,t.innerHTML=this.player1.weapon.damage,o.innerHTML=this.player1.weapon.img,console.log(this.player1.weapon);var i=document.querySelector("#dragonHealthInput"),a=document.querySelector("#dragonAttackInput"),s=document.querySelector("#dragonWeaponPanel");i.innerHTML=this.player2.health,a.innerHTML=this.player2.weapon.damage,s.innerHTML=this.player2.weapon.img},o.prototype.enableFightButton=function(){var e=document.getElementById("P1Attack"),t=document.getElementById("P2Attack"),o=document.getElementById("P1Defend"),i=document.getElementById("P2Defend");console.log(e,t,o,i);var a=this[this.activePlayer];console.log(a),console.log(this.activePlayer),"player1"==this.activePlayer?(e.classList.remove("disabled"),o.classList.remove("disabled"),t.classList.add("disabled"),i.classList.add("disabled")):(t.classList.remove("disabled"),i.classList.remove("disabled"),e.classList.add("disabled"),o.classList.add("disabled"))},o.prototype.createActionButtonsEvents=function(){var i=this,a=Array.from(document.querySelectorAll(".action"));a.forEach(function(e){e.addEventListener("click",function(e){var t=e.target.dataset.actiontype;console.log(t),console.log(a);var o=e.target.dataset.playerkey;if(console.log(o),o!=i.activePlayer)return window.alert("You can't perform an action because the active player is: ".concat(i.activePlayer));switch(t){case"attack":i.performAction({type:"attack"});break;case"defense":i.performAction({type:"defense"})}0<i.player1.health&&0<i.player2.health||(i.player2.health<=0&&alert("PLAYER 1 WINS !!!"),i.player1.health<=0&&alert("PLAYER 2 WINS !!!"),i.gameSetup())})})},o.prototype.performAction=function(e){switch(console.log(e),e.type){case"attack":var t=this["player1"==this.activePlayer?"player2":"player1"],o=this[this.activePlayer];console.log(this.activePlayer),t.health-=t.defending?o.weapon.damage/2:o.weapon.damage,this.getPlayerStats(),console.log("health"+t.health+" weapon"+o.weapon.damage),t.defending=!1;break;case"defense":this[this.activePlayer].defending=!0}this.activePlayer="player1"==this.activePlayer?"player2":"player1",this.enableFightButton()},o.prototype.tryFight=function(){console.log(this.activePlayer),this.isReadyToFight()&&this.enableFightButton()},$(window).on("load",function(){document.getElementById("newGameBtn").addEventListener("click",function(){var e=new o;e.gameSetup(),e.createActionButtonsEvents()}),document.getElementById("rulesButton").addEventListener("click",function(){$("#rulesModal").css("display","block")}),document.getElementById("rulesClose").addEventListener("click",function(){$("#rulesModal").css("display","none")})})}();